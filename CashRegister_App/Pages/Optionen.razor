@page "/optionen"
@using CashRegister.DAL
@using CashRegister.Models
@using CashRegister_App.Data


<div class="body">

    <MudTabs  Elevation="2" Rounded="true" Centered="true" Color="Color.Dark">
        <MudTabPanel OnClick="@(e => ButtonOverlay(1))" Icon="@Icons.Filled.AddCircleOutline" Text="Produkt Hinzufügen" />
        <MudTabPanel OnClick="@(e => ButtonOverlay(2))" Icon="@Icons.Filled.RemoveCircleOutline" Text="Produkt Löschen" />
        <MudTabPanel OnClick="@(e => ButtonOverlay(3))" Icon="@Icons.Outlined.AutoDelete" Text="Beleg Löschen" />
    </MudTabs>
</div>

<div class="containerBody">
    <MudPaper Elevation="0" Style="background-color: #1f1f1f">
        @switch (containerContent)
        {
            case 1:
                <span>1</span>          
                break;

            case 2:
                <span>2</span>
                break;

            case 3:
                <MudDataGrid Style="width: 100%;margin-top: 10px; max-height: 500px;" Items="@belege">
                    <ToolBarContent>
                        <MudText Typo="Typo.h6">Belege</MudText>
                        <MudSpacer />
                        <MudDateRangePicker Label="Basic range picker" @bind-DateRange="_dateRange" />
                    </ToolBarContent>

                    <Columns>
                        <Column T="Beleg" Field="@nameof(Beleg.Belegnummer)" />
                        <Column T="Beleg" Field="@nameof(Beleg.Kaufdatum)" />
                        <Column T="Beleg" Field="@nameof(Beleg.Gesamtpreis)" />
                    </Columns>
                </MudDataGrid>

                <MudButton OnClick="ShowMessagebox" Style="margin-left: 92%; margin-top: 10px; background-color: white; color:black;
                    height: 50px;width:  100px;;" Variant="Variant.Filled" Color="Color.Primary">Primary
                </MudButton>

                break;

            default:
                <span>1</span>
                break;
        }
    </MudPaper>
</div>


<MudMessageBox @ref="mbox" Title="Sicher" CancelText="Abbrechen">
    <MessageContent>
        Sicher das du <b><i>alle</i></b> belege in dem ausgewählten Zeitraum löschen willst?  
    </MessageContent>
    <YesButton>
        <MudButton OnClick="deleteBelege" Variant="Variant.Filled" Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever">Löschen!</MudButton>
    </YesButton>
</MudMessageBox>


@code {
    [Inject] private IDialogService DialogService { get; set; }

    static CashRegisterContextDB context = new CashRegisterContextDB();
    private DateRange _dateRange = new DateRange(DateTime.Now.Date, DateTime.Now.AddDays(5).Date);
    List<Beleg> belege = context.Einkauf.ToList();

    MudMessageBox ?mbox { get; set; }
    public int containerContent;
   
    void deleteBelege()
    {
        context.RemoveRange(belege.Where(x => x.Kaufdatum >= _dateRange.Start && x.Kaufdatum <= _dateRange.End));
        refreshData();
    }


    //Refresh Database Data
    private void refreshData()
    {
        context.SaveChanges();
        belege = context.Einkauf.ToList();
    }

    //Show Messagebox
    private async void ShowMessagebox()
    {
        bool? result = await mbox.Show();
        StateHasChanged();
    }

    public void ButtonOverlay(int i)
    {
        containerContent = i;
    }
}
